#!/bin/bash
# SSH helper tool.  Keep your credentials in configs.
set -e

accounts_dir=${SSH_ACCOUNTS_DIR:="$HOME/.ssh_accounts"}

config_name=$1
if [[ $config_name == '' ]]; then
    echo "You must specify a config name from $accounts_dir"
    echo "ssh- <server><args passed to ssh...>"
    exit 1
fi
shift # remove config_name from args before passing them to ssh

user=$(sed -n 's/.*user *= *\([^ ]*.*\)/\1/p' < $accounts_dir/$config_name.config)
host=$(sed -n 's/.*host *= *\([^ ]*.*\)/\1/p' < $accounts_dir/$config_name.config)
port=$(sed -n 's/.*port *= *\([^ ]*.*\)/\1/p' < $accounts_dir/$config_name.config)

if [[ $user != '' ]]; then
user="$user@"
fi

if [[ $port != '' ]]; then
port="-P $port "
fi

sftp $port $user$host "$@"
